```mermaid
flowchart TD
  %% Users & Interface
  A[User on WhatsApp] -->|Sends “/start”| B(WhatsApp Cloud API / Twilio)
  B --> C[Webhook Receiver]

  %% File Upload & Storage
  C -->|Upload chat.txt| D[Object Storage<br/>(e.g. S3 / Blob)]
  D --> E[Message Parser Service]

  %% Parsing & Analysis
  E --> F[Parsed Messages DB<br/>(e.g. PostgreSQL / MongoDB)]
  E --> G[Analytics Engine<br/>(Python + Pandas)]
  G --> H[Insights Cache<br/>(e.g. Redis)]

  %% Content Generation
  H --> I[Report Formatter<br/>(templates, charts)]
  I --> J[Media Generator<br/>(Matplotlib / Pillow)]

  %% Delivery
  J -->|PNG / Text| K[WhatsApp Cloud API]
  I -->|Text / Buttons| K
  K --> A

  %% Optional AI Layer
  G --> L[OpenAI GPT<br/>(for narrative polishing)]
  L --> I

  style A fill:#f9f,stroke:#333,stroke-width:1px
  style B fill:#bbf,stroke:#333,stroke-width:1px
  style C fill:#bbf,stroke:#333,stroke-width:1px
  style D fill:#bfb,stroke:#333,stroke-width:1px
  style E fill:#fbf,stroke:#333,stroke-width:1px
  style F fill:#ffb,stroke:#333,stroke-width:1px
  style G fill:#ffb,stroke:#333,stroke-width:1px
  style H fill:#ffb,stroke:#333,stroke-width:1px
  style I fill:#bff,stroke:#333,stroke-width:1px
  style J fill:#bff,stroke:#333,stroke-width:1px
  style K fill:#bbf,stroke:#333,stroke-width:1px
  style L fill:#ffd,stroke:#333,stroke-width:1px
